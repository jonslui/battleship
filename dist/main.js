(()=>{"use strict";const e=e=>({createShip:(t,a)=>{e.ships.push(((e,t)=>{let a={name:t,length:e.length,coords:e,hits:[],sunk:!1};return Object.assign({state:a},(e=>({hit:t=>{e.hits.push(t)}}))(a),(e=>({isSunk:()=>{e.hits.length>=e.length&&(e.sunk=!0)}}))(a))})(t,a))}}),t=()=>{let t={missed_attacks:[],ships:[],open_coords:[]};return Object.assign({state:t},e(t),(e=>({receiveAttack:t=>{for(let a=0;a<e.ships.length;a+=1)if(e.ships[a].state.coords.includes(t))return e.ships[a].hit(t),e.ships[a].isSunk(),e.ships[a].state.sunk?e.ships.splice(a,1):"";e.missed_attacks.push(t)}}))(t),(e=>({shipsRemaining:()=>e.ships.length>0}))(t),(e=>({setOpenCoords:t=>{let a=[...Array(100).keys()].map((e=>e+t));e.ships.forEach((e=>{a=a.filter((t=>e.state.coords.indexOf(t)<0))})),e.open_coords=a}}))(t),(e=>({possibleHorizontalPlacements:t=>{let a=e.open_coords,r=[];return a.forEach(((e,l)=>{if(a[l+t-1]===e+t-1&&e%10+t-1<10){let a=[...Array(t)].map(((t,a)=>e+1*a));r.push(a)}})),r}}))(t),(e=>({possibleVerticalPlacements:t=>{let a=e.open_coords;a.sort(((e,t)=>e.toString().slice(-1)>t.toString().slice(-1)?1:e.toString().slice(-1)<t.toString().slice(-1)?-1:0));const r=[];return a.forEach(((e,l)=>{if(a[l+t-1]===e+10*(t-1)){let a=[...Array(t)].map(((t,a)=>e+10*a));r.push(a)}})),r}}))(t))},a=e=>{let t={is_human:e,available_moves:[]};return Object.assign({state:t},(e=>({launchAttack:t=>!!e.available_moves.includes(t)&&e.available_moves.splice(e.available_moves.indexOf(t),1)[0]}))(t),(e=>({randomCoord:()=>e.available_moves[~~(Math.random()*e.available_moves.length)]}))(t),(e=>({populateAvailableMoves:t=>{for(let a=0+t;a<100+t;a+=1)e.available_moves.push(a)}}))(t))},r=()=>{let e={board:null,tiles:{}};return Object.assign({state:e},(e=>({createBoard:t=>{const a=document.getElementById("gameboards_container"),r=document.createElement("div");r.setAttribute("class","gameboard"),r.setAttribute("id",t),a.appendChild(r),e.board=r}}))(e),(e=>({createTiles:(t,a)=>{for(let r=a;r<a+100;r+=1){const a=document.createElement("div");t?a.setAttribute("class","player2_tile"):a.setAttribute("class","player1_tile"),a.setAttribute("id",r),e.tiles[r]=a,e.board.appendChild(a)}}}))(e),{createShips:e=>{e.state.ships.forEach((e=>{e.state.coords.forEach((e=>{const t=document.getElementById(e);t.removeAttribute("class","player1_tile"),t.setAttribute("class","ship")}))}))}},(e=>({changeTileDisplay:(t,a,r)=>{let l=e.tiles[t];a&&null!=r?l.setAttribute("class","hit"):l.setAttribute("class","miss")}}))(e))},l=()=>{let e={player1:null,player2:null,player1Board:null,player2Board:null,player1DOMBoard:null,player2DOMBoard:null};return Object.assign({state:e},(e=>({initializeGame:()=>{e.player1=a(!0),e.player1.populateAvailableMoves(100),e.player1Board=t(),e.player1Board.createShip([0,1,2,3,4],"Carrier"),e.player2=a(!0),e.player2.populateAvailableMoves(0),e.player2Board=t(),e.player2Board.createShip([100,101,102,103,104],"Carrier"),e.player1DOMBoard=r(),e.player1DOMBoard.createBoard("player1_board"),e.player1DOMBoard.createTiles(!1,0),e.player1DOMBoard.createShips(e.player1Board),e.player2DOMBoard=r(),e.player2DOMBoard.createBoard("player2_board"),e.player2DOMBoard.createTiles(!0,100),e.player2DOMBoard.createShips(e.player2Board)}}))(e),(e=>({gameLoop:()=>{for(let t=100;t<200;t++)document.getElementById(t).addEventListener("click",(()=>{const a=e.player1.launchAttack(t);if(0!=a){const t=e.player2Board.receiveAttack(a);if(e.player2DOMBoard.changeTileDisplay(a,!0,t),!1===e.player2Board.shipsRemaining())return void events.emit("gameover");const r=e.player2.randomCoord(),l=e.player1Board.receiveAttack(e.player2.launchAttack(r));if(e.player1DOMBoard.changeTileDisplay(r,!0,l),!1===e.player1Board.shipsRemaining())return void events.emit("gameover")}}))}}))(e))},s=()=>{let e={controller:l()};return Object.assign({controller:e.controller,gameOver:function(){document.getElementById("gameover_container").style.display="inline-block"},newGame:function(){const e=document.getElementById("gameboards_container");if(null!=e.firstChild)for(;e.firstChild;)e.removeChild(e.firstChild);let t=s();t.controller.initializeGame(),t.controller.gameLoop()}})};let i=s();i.newGame(),events.on("gameover",i.gameOver)})();